function chart_statistic(a,t){$.ajax({dataType:"json",url:"/ajax/chart",type:"get",cache:!1,data:{date:a.format("YYYY-M-D"),web:t},beforeSend:function(){$(".ajax-loading").css("display","block")},success:function(a){$(".ajax-loading").css("display","none");var e=[{label:"&nbsp;"+("webapp"==t?"เจ้าหน้าที่":"ผู้เข้าชม"),data:a.visitors,color:"#337ab7"}],i=options_line_chart();if($.plot($("#visitor-"+t+"-flot-line-chart"),e,i),$("<div class='axisLabel xaxisLabel'></div>").text("วันที่").appendTo($("#visitor-"+t+"-flot-line-chart")),$("<div class='axisLabel yaxisLabel'></div>").text("website"!=t?"จำนวนการเข้าในงานระบบ (ครั้ง)":"จำนวนการเข้าชม (ครั้ง)").appendTo($("#visitor-"+t+"-flot-line-chart")).css("margin-top",$("<div class='axisLabel yaxisLabel'></div>").width()/2-20),"mobileapp"!=t){var s=[{label:"&nbsp;ระบบปฏิบัติการ",data:a.platforms[0],color:"#3c763d"}],l=options_bar_chart(a.platforms[1],a.platforms[0].length);$.plot($("#platform-"+t+"-flot-bar-chart"),s,l),$("<div class='axisLabel yaxisLabel'></div>").text("webapp"==t?"จำนวนการเข้าในงานระบบ (ครั้ง)":"จำนวนการเข้าชม (ครั้ง)").appendTo($("#platform-"+t+"-flot-bar-chart")).css("margin-top",$("<div class='axisLabel yaxisLabel'></div>").width()/2-20);var o=[{label:"&nbsp;เบราเซอร์",data:a.browsers[0],color:"#dd4b39"}],r=options_bar_chart(a.browsers[1],a.browsers[0].length);$.plot($("#browser-"+t+"-flot-bar-chart"),o,r),$("<div class='axisLabel yaxisLabel'></div>").text("webapp"==t?"จำนวนการเข้าในงานระบบ (ครั้ง)":"จำนวนการเข้าชม (ครั้ง)").appendTo($("#browser-"+t+"-flot-bar-chart")).css("margin-top",$("<div class='axisLabel yaxisLabel'></div>").width()/2-20)}}})}function options_line_chart(){var a={series:{lines:{show:!0,fill:!0,fillColor:{colors:[{opacity:.7},{opacity:.1}]}},points:{show:!0}},legend:{noColumns:0,position:"ne"},grid:{hoverable:!0,minBorderMargin:20,labelMargin:10,margin:{top:0,bottom:20,left:20}},xaxis:{labelWidth:30,tickDecimals:0,minTickSize:1},yaxis:{min:0,labelWidth:30,tickDecimals:0,minTickSize:1},tooltip:!0,tooltipOpts:{content:customTooltip}};return a}function options_bar_chart(a,t){var e={series:{bars:{show:!0,fill:!0,fillColor:{colors:[{opacity:.2},{opacity:.7}]}}},bars:{align:"center",barWidth:.5},legend:{noColumns:0,position:"ne"},grid:{hoverable:!0,minBorderMargin:20,labelMargin:10,margin:{top:0,bottom:0,left:20}},xaxis:{min:0,max:t+1,labelWidth:30,tickDecimals:0,minTickSize:1,ticks:a},yaxis:{min:0,labelWidth:30,tickDecimals:0,minTickSize:1},tooltip:!0,tooltipOpts:{content:"%x: %y ครั้ง"}};return e}function detail_statistic(a){$("#dataTables-website").dataTable().fnDestroy(),$("#dataTables-website").dataTable({ajax:{url:"/ajax/detail",type:"get",data:{date:a.format("YYYY-M-D"),web:"website"}}}),$("#dataTables-webapp").dataTable().fnDestroy(),$("#dataTables-webapp").dataTable({ajax:{url:"/ajax/detail",type:"get",data:{date:a.format("YYYY-M-D"),web:"webapp"}}}),$("#dataTables-mobileapp").dataTable().fnDestroy(),$("#dataTables-mobileapp").dataTable()}function thai_date(a){var t={January:"มกราคม",February:"กุมภาพันธ์",March:"มีนาคม",April:"เมษายน",May:"พฤษภาคม",June:"มิถุนายน",July:"กรกฎาคม",August:"สิงหาคม",September:"กันยายน",October:"ตุลาคม",November:"พฤศจิกายน",December:"ธันวาคม"},e=t[a.format("MMMM")],i=parseInt(a.format("YYYY"),10)+543;return e+" "+i.toString()}function customTooltip(a,t,e){return"วันที่ "+t+" จำนวน "+e+" ครั้ง"}$(document).ready(function(){var a=moment($("#datepicker").find("input").val(),"YYYY-MM");$(".display-month").html(thai_date(a)),$(".ajax-loading").css("display","none"),detail_statistic(a),chart_statistic(a,"website"),$('#chart a[data-toggle="tab"]').on("shown.bs.tab",function(a){var t=moment($("#datepicker").find("input").val(),"YYYY-MM");switch($.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust(),$(a.target).attr("href")){default:chart_statistic(t,"website");break;case"#webapp":chart_statistic(t,"webapp");break;case"#mobileapp":chart_statistic(t,"mobileapp")}}),$("#datepicker").datetimepicker({viewMode:"months",format:"YYYY-MM"}).on("dp.change",function(a){switch($(".display-month").html(thai_date(a.date)),detail_statistic(a.date),$("ul.nav-tabs li.active a").attr("href")){default:chart_statistic(a.date,"website");break;case"#webapp":chart_statistic(a.date,"webapp");break;case"#mobileapp":chart_statistic(a.date,"mobileapp")}})});