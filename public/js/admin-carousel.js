function createForm(){$.ajax({dataType:"json",url:"/ajax/documentlists",type:"get",cache:!1,error:function(e,a,t){},success:function(e){var a='<li class="carousel-item unsortable" style="cursor: default;">';a+='<div class="form-group" style="position: relative; border: 1px solid lightgray; padding: 10px;">',a+='<div class="row">',a+='<div class="col-md-2">',a+='<div id="carousel-new" class="carousel-link" onclick="$(\'#image-new\').click();">',a+='<div class="carousel-hover">',a+='<div class="carousel-hover-content">',a+='<i class="fa fa-image fa-2x"></i>',a+="</div>",a+="</div>",a+='<img id="preview-new" src="/images/carousel.png" class="img-responsive" alt="" />',a+="</div>",a+="</div>",a+='<div class="col-md-10">',a+="<label>",a+='<i class="fa fa-link fa-fw"></i>',a+="เอกสาร/แบบฟอร์ม",a+="</label>",a+='<select id="document-type-new" name="document-type-new" class="form-control" onchange="javascript:typeChange($(this).val(), $(\'#document-new\'));">',$.each(e.document_types,function(e,t){a+='<option value="'+t.id+'">'+t.display+"</option>"}),a+="</select>",a+='<select id="document-new" name="document-new" class="form-control margin-t-xs margin-b-xs">',$.each(e.documents,function(e,t){a+='<option value="'+t.id+'">'+t.display+"</option>"}),a+="</select>",a+="<br />",a+='<button id="save" type="button" class="btn btn-primary btn-flat" onclick="javascript:uploadImage(document.getElementById(\'image-new\'), $(\'#document-new\').val(), this);">',a+='<i class="fa fa-save fa-fw"></i> บันทึก',a+="</button>",a+='<button id="cancel" type="button" class="btn btn-danger btn-flat margin-r-xs margin-l-sm" onclick="javascript:cancel(this);">',a+='<i class="fa fa-ban fa-fw"></i> ยกเลิก',a+="</button>",a+='<span id="result-new"></span>',a+='<input type="file" id="image-new" name="image-new" class="file-upload" accept="image/jpeg" ',a+="onchange=\"javascript:selectImage(this, $('#preview-new'))\">",a+="</div>",a+="</div>",a+="</div>",a+="</li>",$("#carousel").append(a),$("#add").hide()}})}function cancel(e){e.closest("ul li:last-child").remove(),$("#add").show()}function typeChange(e,a){$.ajax({dataType:"json",url:"/ajax/documentsbytype",type:"get",cache:!1,data:{id:e},error:function(e,a,t){},success:function(e){a.empty(),$.each(e.documents,function(e,t){a.append('<option value="'+t.id+'">'+t.display+"</option>")})}})}function selectImage(e,a){if(e.files&&e.files[0]){var t=new FileReader;t.onload=function(e){var t=new Image;t.onload=function(){var e=t.width,a=t.height,s=256,i=144;e>a?e>s&&(a*=s/e,e=s):a>i&&(e*=i/a,a=i);var n=document.createElement("canvas");n.width=e,n.height=a,n.getContext("2d").drawImage(this,0,0,e,a),this.src=n.toDataURL()},t.src=e.target.result,a.attr("src",t.src)},t.readAsDataURL(e.files[0])}}function uploadImage(e,a,t){if(e.files&&e.files[0]){var s=new FileReader,i=e.files[0];s.onload=function(e){var s=new Image;s.onload=function(){var e=s.width,n=s.height;if(768==e&&432==n)if(i.size<20971520){var l=new FormData;l.append("image",i),l.append("document_id",a),$.ajax({dataType:"json",url:"/ajax/uploadcarousel",type:"post",cache:!1,data:l,processData:!1,contentType:!1,error:function(e,a,t){$("#result-new").html('<span class="text-danger"><i class="fa fa-times-circle fa-fw"></i> เกิดข้อผิดพลาดในการอัฟโหลด</span>'),$("#result-new").show().delay(3e3).fadeOut(),$("#cancel").show()},beforeSend:function(){$("#result-new").html('<i class="fa fa-spinner fa-pulse"></i> Uploading... (<span id="progress-new">0</span>%)'),$("#result-new").show(),$("#document-type-new").hide(),$("#document-new").hide(),$("#carousel-new").attr("onclick",""),$("#carousel-new").removeClass("carousel-link"),$(".carousel-hover").html(""),$("#save").hide(),$("#cancel").hide()},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){$("#progress-new").html(Math.ceil(e.loaded/e.total*100))},e},success:function(e){$("#add").show(),t.closest("ul li:last-child").remove(),writeItem(e)}})}else $("#result-new").html('<span class="text-danger"><i class="fa fa-times-circle fa-fw"></i> รูปที่ใช้ต้องมีขนาดไม่เกิน 20M</span>'),$("#result-new").show().delay(3e3).fadeOut();else $("#result-new").html('<span class="text-danger"><i class="fa fa-times-circle fa-fw"></i> รูปที่ใช้ต้องมีขนาด 768x432 พิกเซลเท่านั้น</span>'),$("#result-new").show().delay(3e3).fadeOut()},s.src=e.target.result},s.readAsDataURL(e.files[0])}else $("#result-new").html('<span class="text-danger"><i class="fa fa-times-circle fa-fw"></i> กรุณาเลือกรูปที่ต้องการขนาด 768x432 พิกเซล</span>'),$("#result-new").show().delay(3e3).fadeOut()}function writeItem(e){var a='<li id="item-'+e.id+'" class="carousel-item">';a+='<div class="form-group" style="position: relative; border: 1px solid lightgray; padding: 10px;">',a+='<div class="row">',a+='<div class="col-md-2">',a+='<div class="carousel-link" onclick="$(\'#image-'+e.id+"').click();\">",a+='<div class="carousel-hover">',a+='<div class="carousel-hover-content">',a+='<i class="fa fa-image fa-2x"></i>',a+="</div>",a+="</div>",a+='<img id="preview-'+e.id+'" src="'+e.thumbnail+'" class="img-responsive" alt="" />',a+="</div>",a+="</div>",a+='<div class="col-md-10">',a+="<label>",a+='<i class="fa fa-link fa-fw"></i>',a+="เอกสาร/แบบฟอร์ม",a+="</label>",a+='<select id="document-type-'+e.id+'" name="document-type-'+e.id+'" ',a+='class="form-control" ',a+="onchange=\"javascript:typeChange($(this).val(), $('#document-"+e.id+"'));\">",$.each(e.document_types,function(t,s){a+=e.document_type_id==s.id?'<option value="'+s.id+'" selected>'+s.display+"</option>":'<option value="'+s.id+'">'+s.display+"</option>"}),a+="</select>",a+='<select id="document-'+e.id+'" name="document-'+e.id+'" ',a+='class="form-control margin-t-xs margin-b-xs" ',a+='onchange="javascript:updateDocument('+e.id+', $(this).val());">',$.each(e.documents,function(t,s){a+=e.document_id==s.id?'<option value="'+s.id+'" selected>'+s.display+"</option>":'<option value="'+s.id+'">'+s.display+"</option>"}),a+="</select>",a+='<span id="result-'+e.id+'"></span>',a+='<button id="delete" type="button" class="btn btn-danger btn-flat pull-right" ',a+="onclick=\"javascript:var result = confirm('Do you want to delete this carousel?'); if (result) { deleteCarousel("+e.id+'); }">',a+='<i class="fa fa-trash fa-fw"></i> ลบ',a+="</button>",a+='<input type="file" id="image-'+e.id+'" name="image-'+e.id+'" ',a+='class="file-upload" accept="image/jpeg" onchange="javascript:updateImage('+e.id+', this);" />',a+="</div>",a+="</div>",a+="</div>",a+="</li>",$("#carousel").append(a)}function updateDocument(e,a){var t=new FormData;t.append("id",e),t.append("document_id",a),$.ajax({dataType:"json",url:"/ajax/updatecarouseldocument",type:"post",cache:!1,data:t,processData:!1,contentType:!1,error:function(a,t,s){$("#result-"+e).html('<span class="text-danger"><i class="fa fa-times-circle fa-fw"></i> เกิดข้อผิดพลาด</span>'),$("#result-"+e).show().delay(3e3).fadeOut()},success:function(a){$("#result-"+a.id).html('<span class="text-success"><i class="fa fa-check-circle fa-fw"></i> บันทึกข้อมูลเรียบร้อย</span>'),$("#result-"+e).show().delay(3e3).fadeOut()}})}function updateImage(e,a){if(a.files&&a.files[0]){var t=new FileReader,s=a.files[0];t.onload=function(a){var t=new Image;t.onload=function(){var a=t.width,i=t.height;if(768==a&&432==i)if(s.size<20971520){var n=new FormData;n.append("id",e),n.append("image",s),$.ajax({dataType:"json",url:"/ajax/updatecarouselimage",type:"post",cache:!1,data:n,processData:!1,contentType:!1,error:function(a,t,s){$("#result-"+e).html('<span class="text-danger"><i class="fa fa-times-circle fa-fw"></i> เกิดข้อผิดพลาดในการอัฟโหลด</span>'),$("#result-"+e).show().delay(3e3).fadeOut()},beforeSend:function(){$("#result-"+e).html('<i class="fa fa-spinner fa-pulse"></i> Uploading... (<span id="progress-new">0</span>%)'),$("#result-"+e).show()},xhr:function(){var a=$.ajaxSettings.xhr();return a.upload.onprogress=function(a){$("#progress-"+e).html(Math.ceil(a.loaded/a.total*100))},a},success:function(a){$("#preview-"+a.id).attr("src",a.thumbnail),$("#result-"+a.id).html('<span class="text-success"><i class="fa fa-check-circle fa-fw"></i> บันทึกข้อมูลเรียบร้อย</span>'),$("#result-"+e).show().delay(3e3).fadeOut()}})}else $("#result-"+e).html('<span class="text-danger"><i class="fa fa-times-circle fa-fw"></i> รูปที่ใช้ต้องมีขนาดไม่เกิน 20M</span>'),$("#result-"+e).show().delay(3e3).fadeOut();else $("#result-"+e).html('<span class="text-danger"><i class="fa fa-times-circle fa-fw"></i> รูปที่ใช้ต้องมีขนาด 768x432 พิกเซลเท่านั้น</span>'),$("#result-"+e).show().delay(3e3).fadeOut()},t.src=a.target.result},t.readAsDataURL(a.files[0])}else $("#result-"+e).html('<span class="text-danger"><i class="fa fa-times-circle fa-fw"></i> กรุณาเลือกรูปที่ต้องการขนาด 768x432 พิกเซล</span>')}function deleteCarousel(e){$.ajax({dataType:"json",url:"/ajax/deletecarousel",type:"post",cache:!1,data:{id:e},error:function(e,a,t){},success:function(e){$("#item-"+e).remove()}})}function reorder(e,a){$.ajax({dataType:"json",url:"/ajax/reordercarousel",type:"get",cache:!1,data:{id:e,index:a},error:function(e,a,t){},success:function(e){}})}$(document).ready(function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$("#carousel").sortable({placeholder:"ui-state-highlight",items:"li:not(.unsortable)",update:function(e,a){var t=a.item.attr("id").replace("item-",""),s=a.item.index();reorder(t,s)}}),$("#add").click(function(){createForm()})});