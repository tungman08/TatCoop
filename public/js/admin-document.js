function display(){$.ajax({dataType:"json",url:"/ajax/documents",type:"post",cache:!1,error:function(t,e,a){console.log(t.responseText),console.log(a)},beforeSend:function(){$("#ruleTree").html('<li class="item"><i class="fa fa-spinner fa-pulse"></i></li>'),$("#formTree").html('<li class="item"><i class="fa fa-spinner fa-pulse"></i></li>')},success:function(t){$("#ruleTree").html(""),$("#formTree").html(""),show(t.rules,$("#ruleTree")),show(t.forms,$("#formTree"))}})}function show(t,e){$.each(t,function(t,a){var i='<li id="item-'+a.id.toString()+'" class="item">';i+='<div class="input-group">',i+=writeFile(a.id,a.display),i+='<div id="button-'+a.id.toString()+'" class="input-group-btn">',i+=writeFileButton(a.id),i+="</div>",i+="</div>",i+="</li>",e.append(i)})}function reorder(t,e){$.ajax({dataType:"json",url:"/ajax/reorder",type:"post",cache:!1,data:{id:t,index:e},error:function(t,e,a){console.log(t.responseText),console.log(a)},success:function(t){console.log(t)}})}function writeFile(t,e){var a='<div class="form-control file-caption kv-fileinput-caption">';return a+='<input type="file" id="input-'+t.toString()+'" name="input-'+t.toString()+'" class="file-upload" accept="application/pdf" ',a+="onchange=\"javascript:selectFile(null, $('#input-"+t+"'), '"+t+"')\">",a+='<div id="caption-'+t.toString()+'" class="file-caption-name">',a+='<i class="fa fa-file-pdf-o fa-fw"></i> '+e,a+="</div>",a+="</div>"}function writeFileButton(t){var e='<button id="more-'+t.toString()+'" class="btn btn-default btn-background dropdown-toggle" title="More..." type="button" data-toggle="dropdown">';return e+='<i class="fa fa-gear"></i> ',e+='<i class="fa fa-caret-down"></i>',e+="</button>",e+='<ul class="dropdown-menu pull-right">',e+="<li>",e+='<a href="javascript:void(0);" onclick="javascript:editFileMode('+t.toString()+');"><i class="fa fa-edit fa-fw"></i> Edit</a>',e+="</li>",e+="<li>",e+='<a href="javascript:void(0);" ',e+="onclick=\"javascript:var result = confirm('Do you want to delete this file?'); if (result) { deleteFile("+t.toString()+'); }"><i class="fa fa-trash-o fa-fw"></i> Delete</a>',e+="</li>",e+="</ul>"}function addFile(t,e){var a=t.attr("id")+"-temp-"+e.children("li").length.toString(),i='<li id="item-'+a+'" class="item">';i+='<div class="input-group">',i+=writeUploadFile(t,a),i+='<div id="button-'+a+'" class="input-group-btn">',i+='<button type="button" class="btn btn-default btn-background" title="Cancel" onclick="javascript:cancelFile($(\'#'+t.attr("id")+"'), this);\">",i+='<i class="fa fa-ban"></i>',i+="</button>",i+='<button type="button" class="btn btn-primary" title="Browse" onclick="$(\'#input-'+a+"').click();\">",i+='<i class="fa fa-folder-open-o"></i>',i+="</button>",i+="</div>",i+="</div>",i+="</li>",e.append(i),t.addClass("disabled")}function writeUploadFile(t,e){var a='<div class="form-control file-caption kv-fileinput-caption" tabindex="500">';return a+='<input type="file" id="input-'+e+'" name="input-'+e+'" class="file-upload" accept="application/pdf" ',a+="onchange=\"javascript:selectFile($('#"+t.attr("id")+"'), $('#input-"+e+"'), '"+e+"')\">",a+='<div id="caption-'+e+'" class="file-caption-name">',a+="</div>",a+="</div>"}function selectFile(t,e,a){if(null!=t){$("#button-"+a).children("button").length>2&&$("#button-"+a).find("button:first").remove();var i='<button type="button" class="btn btn-default btn-background" title="Upload" ';i+="onclick=\"javascript:uploadFile($('#"+t.attr("id")+"'), $('#"+e.attr("id")+"'), '"+a+"');\">",i+='<i class="fa fa-arrow-circle-o-up"></i>',i+="</button>",$("#button-"+a).prepend(i),$("#caption-"+a).html('<i class="fa fa-file fa-fw"></i> '+e.val())}else{$("#button-"+a).children("button").length>2&&$("#button-"+a).find("button:first").remove();var i='<button type="button" class="btn btn-default btn-background" title="Upload" ';i+="onclick=\"javascript:updateFile($('#"+e.attr("id")+"'), '"+a+"');\">",i+='<i class="fa fa-arrow-circle-o-up"></i>',i+="</button>",$("#button-"+a).prepend(i),$("#caption-"+a).html('<i class="fa fa-file fa-fw"></i> '+e.val())}}function cancelFile(t,e){e.closest("ul li:last-child").remove(),t.removeClass("disabled")}function uploadFile(t,e,a){var i=e.get(0).files[0],n=new FormData;n.append("File",i),n.append("DocType",fileTypeID(t.attr("id"))),i.size<20971520?$.ajax({dataType:"json",url:"/ajax/uploadfile",type:"post",cache:!1,data:n,processData:!1,contentType:!1,error:function(t,e,i){$("#caption-"+a).addClass("text-danger"),$("#caption-"+a).html('<i class="fa fa-times-circle fa-fw"></i> Upload failed.'),$("#button-"+a).find("button").removeClass("disabled"),console.log(t.responseText),console.log(i)},beforeSend:function(){$("#caption-"+a).html('<i class="fa fa-spinner fa-pulse"></i> Uploading... (<span id="progress-'+a+'">0</span>%)'),$("#button-"+a).find("button:first").remove(),$("#button-"+a).find("button:last").remove(),$("#button-"+a).find("button").removeClass("btn-default"),$("#button-"+a).find("button").removeClass("btn-background"),$("#button-"+a).find("button").addClass("btn-danger"),$("#button-"+a).find("button").addClass("disabled")},xhr:function(){var t=$.ajaxSettings.xhr();return t.upload.onprogress=function(t){$("#progress-"+a).html(Math.ceil(t.loaded/t.total*100))},t.upload.onload=function(){$("#caption-"+a).html('<i class="fa fa-clock-o fa-fw"></i> Please wait...')},t},success:function(e){$("#item-"+a).replaceWith(writeItem(e)),t.removeClass("disabled")}}):alert("File is to big")}function writeItem(t){var e='<li id="item-'+t.id.toString()+'" class="item">';return e+='<div class="input-group">',e+=writeFile(t.id,t.Display),e+='<div id="button-'+t.id+'" class="input-group-btn">',e+=writeFileButton(t.id),e+="</div>",e+="</div>",e+="</li>"}function editFileMode(t){$("#button-"+t).html(writeUploadFileButton(t))}function writeUploadFileButton(t){var e='<button type="button" class="btn btn-default btn-background" title="Cancel" onclick="javascript:cancelEditFile('+t+');">';return e+='<i class="fa fa-ban"></i>',e+="</button>",e+='<button type="button" class="btn btn-primary" title="Browse" onclick="$(\'#input-'+t+"').click();\">",e+='<i class="fa fa-folder-open-o"></i>',e+="</button>"}function cancelEditFile(t){$("#button-"+t).html(writeFileButton(t)),$.ajax({dataType:"json",url:"/ajax/restorefile",type:"post",cache:!1,data:{id:t},error:function(t,e,a){console.log(t.responseText),console.log(a)},success:function(e){$("#caption-"+t).html('<i class="fa fa-file-pdf-o fa-fw"></i> '+e.display)}})}function updateFile(t,e){var a=t.get(0).files[0],i=new FormData;i.append("ID",e),i.append("File",a),a.size<20971520?$.ajax({dataType:"json",url:"/ajax/updatefile",type:"post",cache:!1,data:i,processData:!1,contentType:!1,error:function(t,a,i){$("#caption-"+e).addClass("text-danger"),$("#caption-"+e).html('<i class="fa fa-times-circle fa-fw"></i> Upload failed.'),$("#button-"+e).find("button").removeClass("disabled"),console.log(t.responseText),console.log(i)},beforeSend:function(){$("#caption-"+e).html('<i class="fa fa-spinner fa-pulse"></i> Uploading... (<span id="progress-'+e+'">0</span>%)'),$("#button-"+e).find("button:first").remove(),$("#button-"+e).find("button:last").remove(),$("#button-"+e).find("button").removeClass("btn-default"),$("#button-"+e).find("button").removeClass("btn-background"),$("#button-"+e).find("button").addClass("btn-danger"),$("#button-"+e).find("button").addClass("disabled")},xhr:function(){var t=$.ajaxSettings.xhr();return t.upload.onprogress=function(t){$("#progress-"+e).html(Math.ceil(t.loaded/t.total*100))},t.upload.onload=function(){$("#caption-"+e).html('<i class="fa fa-clock-o fa-fw"></i> Please wait...')},t},success:function(t){$("#item-"+e).replaceWith(writeItem(t))}}):alert("File is to big")}function deleteFile(t){$.ajax({dataType:"json",url:"/ajax/deletefile",type:"post",cache:!1,data:{id:t},error:function(t,e,a){console.log(t.responseText),console.log(a)},success:function(t){$("#item-"+t).remove()}})}function updateOther(t){var e=$("#file-"+t).get(0).files[0],a=new FormData;a.append("id",t),a.append("file",e),e.size<20971520?$.ajax({dataType:"json",url:"/ajax/updateother",type:"post",cache:!1,data:a,processData:!1,contentType:!1,error:function(e,a,i){$("#caption-"+t).addClass("text-danger"),$("#caption-"+t).html('<i class="fa fa-times-circle fa-fw"></i> Upload failed.'),console.log(e.responseText),console.log(i)},beforeSend:function(){$("#caption-"+t).html('<i class="fa fa-spinner fa-pulse"></i> Uploading... (<span id="progress-'+t+'">0</span>%)')},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){$("#progress-"+t).html(Math.ceil(e.loaded/e.total*100))},e.upload.onload=function(){$("#caption-"+t).html('<i class="fa fa-clock-o fa-fw"></i> Please wait...')},e},success:function(e){$("#caption-"+t).html(e)}}):alert("File is to big")}function fileTypeID(t){switch(t){case"Rule":return 1;case"Form":return 2;default:return 3}}$(document).ready(function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),display(),$("#Rule").click(function(){addFile($(this),$("#ruleTree"))}),$("#Form").click(function(){addFile($(this),$("#formTree"))}),$("#ruleTree").sortable({placeholder:"ui-state-highlight",update:function(t,e){var a=e.item.attr("id").replace("item-",""),i=e.item.index();reorder(a,i)}}),$("#formTree").sortable({placeholder:"ui-state-highlight",update:function(t,e){var a=e.item.attr("id").replace("item-",""),i=e.item.index();reorder(a,i)}})});