function display(){$.ajax({dataType:"json",url:"/ajax/documents",type:"post",cache:!1,error:function(t,a,i){},beforeSend:function(){$("#ruleTree").html('<li class="item"><i class="fa fa-spinner fa-pulse"></i></li>'),$("#formTree").html('<li class="item"><i class="fa fa-spinner fa-pulse"></i></li>')},success:function(t){$("#ruleTree").html(""),$("#formTree").html(""),show(t.rules,$("#ruleTree")),show(t.forms,$("#formTree"))}})}function show(t,a){$.each(t,function(t,i){var e='<li id="item-'+i.id.toString()+'" class="item">';e+='<div class="input-group">',e+=writeFile(i.id,i.display),e+='<div id="button-'+i.id.toString()+'" class="input-group-btn">',e+=writeFileButton(i.id),e+="</div>",e+="</div>",e+="</li>",a.append(e)})}function reorder(t,a){$.ajax({dataType:"json",url:"/ajax/reorder",type:"post",cache:!1,data:{id:t,index:a},error:function(t,a,i){},success:function(t){}})}function writeFile(t,a){var i='<div class="form-control file-caption kv-fileinput-caption">';return i+='<input type="file" id="input-'+t.toString()+'" name="input-'+t.toString()+'" class="file-upload" accept="application/pdf" ',i+="onchange=\"javascript:selectFile(null, $('#input-"+t+"'), '"+t+"')\">",i+='<div id="caption-'+t.toString()+'" class="file-caption-name">',i+='<i class="fa fa-file-pdf-o fa-fw"></i> '+a,i+="</div>",i+="</div>"}function writeFileButton(t){var a='<button id="more-'+t.toString()+'" class="btn btn-default btn-background dropdown-toggle" title="More..." type="button" data-toggle="dropdown">';return a+='<i class="fa fa-gear"></i> ',a+='<i class="fa fa-caret-down"></i>',a+="</button>",a+='<ul class="dropdown-menu pull-right">',a+="<li>",a+='<a href="javascript:void(0);" onclick="javascript:editFileMode('+t.toString()+');"><i class="fa fa-edit fa-fw"></i> Edit</a>',a+="</li>",a+="<li>",a+='<a href="javascript:void(0);" ',a+="onclick=\"javascript:var result = confirm('Do you want to delete this file?'); if (result) { deleteFile("+t.toString()+'); }"><i class="fa fa-trash-o fa-fw"></i> Delete</a>',a+="</li>",a+="</ul>"}function addFile(t,a){var i=t.attr("id")+"-temp-"+a.children("li").length.toString(),e='<li id="item-'+i+'" class="item">';e+='<div class="input-group">',e+=writeUploadFile(t,i),e+='<div id="button-'+i+'" class="input-group-btn">',e+='<button type="button" class="btn btn-default btn-background" title="Cancel" onclick="javascript:cancelFile($(\'#'+t.attr("id")+"'), this);\">",e+='<i class="fa fa-ban"></i>',e+="</button>",e+='<button type="button" class="btn btn-primary" title="Browse" onclick="$(\'#input-'+i+"').click();\">",e+='<i class="fa fa-folder-open-o"></i>',e+="</button>",e+="</div>",e+="</div>",e+="</li>",a.append(e),t.addClass("disabled")}function writeUploadFile(t,a){var i='<div class="form-control file-caption kv-fileinput-caption" tabindex="500">';return i+='<input type="file" id="input-'+a+'" name="input-'+a+'" class="file-upload" accept="application/pdf" ',i+="onchange=\"javascript:selectFile($('#"+t.attr("id")+"'), $('#input-"+a+"'), '"+a+"')\">",i+='<div id="caption-'+a+'" class="file-caption-name">',i+="</div>",i+="</div>"}function selectFile(t,a,i){if(null!=t){$("#button-"+i).children("button").length>2&&$("#button-"+i).find("button:first").remove();var e='<button type="button" class="btn btn-default btn-background" title="Upload" ';e+="onclick=\"javascript:uploadFile($('#"+t.attr("id")+"'), $('#"+a.attr("id")+"'), '"+i+"');\">",e+='<i class="fa fa-arrow-circle-o-up"></i>',e+="</button>",$("#button-"+i).prepend(e),$("#caption-"+i).html('<i class="fa fa-file fa-fw"></i> '+a.val())}else{$("#button-"+i).children("button").length>2&&$("#button-"+i).find("button:first").remove();var e='<button type="button" class="btn btn-default btn-background" title="Upload" ';e+="onclick=\"javascript:updateFile($('#"+a.attr("id")+"'), '"+i+"');\">",e+='<i class="fa fa-arrow-circle-o-up"></i>',e+="</button>",$("#button-"+i).prepend(e),$("#caption-"+i).html('<i class="fa fa-file fa-fw"></i> '+a.val())}}function cancelFile(t,a){a.closest("ul li:last-child").remove(),t.removeClass("disabled")}function uploadFile(t,a,i){var e=a.get(0).files[0],n=new FormData;n.append("File",e),n.append("DocType",fileTypeID(t.attr("id"))),e.size<20971520?$.ajax({dataType:"json",url:"/ajax/uploadfile",type:"post",cache:!1,data:n,processData:!1,contentType:!1,error:function(t,a,e){$("#caption-"+i).addClass("text-danger"),$("#caption-"+i).html('<i class="fa fa-times-circle fa-fw"></i> Upload failed.'),$("#button-"+i).find("button").removeClass("disabled")},beforeSend:function(){$("#caption-"+i).html('<i class="fa fa-spinner fa-pulse"></i> Uploading... (<span id="progress-'+i+'">0</span>%)'),$("#button-"+i).find("button:first").remove(),$("#button-"+i).find("button:last").remove(),$("#button-"+i).find("button").removeClass("btn-default"),$("#button-"+i).find("button").removeClass("btn-background"),$("#button-"+i).find("button").addClass("btn-danger"),$("#button-"+i).find("button").addClass("disabled")},xhr:function(){var t=$.ajaxSettings.xhr();return t.upload.onprogress=function(t){$("#progress-"+i).html(Math.ceil(t.loaded/t.total*100))},t.upload.onload=function(){$("#caption-"+i).html('<i class="fa fa-clock-o fa-fw"></i> Please wait...')},t},success:function(a){$("#item-"+i).replaceWith(writeItem(a)),t.removeClass("disabled")}}):alert("File is to big")}function writeItem(t){var a='<li id="item-'+t.id.toString()+'" class="item">';return a+='<div class="input-group">',a+=writeFile(t.id,t.Display),a+='<div id="button-'+t.id+'" class="input-group-btn">',a+=writeFileButton(t.id),a+="</div>",a+="</div>",a+="</li>"}function editFileMode(t){$("#button-"+t).html(writeUploadFileButton(t))}function writeUploadFileButton(t){var a='<button type="button" class="btn btn-default btn-background" title="Cancel" onclick="javascript:cancelEditFile('+t+');">';return a+='<i class="fa fa-ban"></i>',a+="</button>",a+='<button type="button" class="btn btn-primary" title="Browse" onclick="$(\'#input-'+t+"').click();\">",a+='<i class="fa fa-folder-open-o"></i>',a+="</button>"}function cancelEditFile(t){$("#button-"+t).html(writeFileButton(t)),$.ajax({dataType:"json",url:"/ajax/restorefile",type:"post",cache:!1,data:{id:t},error:function(t,a,i){},success:function(a){$("#caption-"+t).html('<i class="fa fa-file-pdf-o fa-fw"></i> '+a.display)}})}function updateFile(t,a){var i=t.get(0).files[0],e=new FormData;e.append("ID",a),e.append("File",i),i.size<20971520?$.ajax({dataType:"json",url:"/ajax/updatefile",type:"post",cache:!1,data:e,processData:!1,contentType:!1,error:function(t,i,e){$("#caption-"+a).addClass("text-danger"),$("#caption-"+a).html('<i class="fa fa-times-circle fa-fw"></i> Upload failed.'),$("#button-"+a).find("button").removeClass("disabled")},beforeSend:function(){$("#caption-"+a).html('<i class="fa fa-spinner fa-pulse"></i> Uploading... (<span id="progress-'+a+'">0</span>%)'),$("#button-"+a).find("button:first").remove(),$("#button-"+a).find("button:last").remove(),$("#button-"+a).find("button").removeClass("btn-default"),$("#button-"+a).find("button").removeClass("btn-background"),$("#button-"+a).find("button").addClass("btn-danger"),$("#button-"+a).find("button").addClass("disabled")},xhr:function(){var t=$.ajaxSettings.xhr();return t.upload.onprogress=function(t){$("#progress-"+a).html(Math.ceil(t.loaded/t.total*100))},t.upload.onload=function(){$("#caption-"+a).html('<i class="fa fa-clock-o fa-fw"></i> Please wait...')},t},success:function(t){$("#item-"+a).replaceWith(writeItem(t))}}):alert("File is to big")}function deleteFile(t){$.ajax({dataType:"json",url:"/ajax/deletefile",type:"post",cache:!1,data:{id:t},error:function(t,a,i){},success:function(t){$("#item-"+t).remove()}})}function updateOther(t){var a=$("#file-"+t).get(0).files[0],i=new FormData;i.append("id",t),i.append("file",a),a.size<20971520?$.ajax({dataType:"json",url:"/ajax/updateother",type:"post",cache:!1,data:i,processData:!1,contentType:!1,error:function(a,i,e){$("#caption-"+t).addClass("text-danger"),$("#caption-"+t).html('<i class="fa fa-times-circle fa-fw"></i> Upload failed.')},beforeSend:function(){$("#caption-"+t).html('<i class="fa fa-spinner fa-pulse"></i> Uploading... (<span id="progress-'+t+'">0</span>%)')},xhr:function(){var a=$.ajaxSettings.xhr();return a.upload.onprogress=function(a){$("#progress-"+t).html(Math.ceil(a.loaded/a.total*100))},a.upload.onload=function(){$("#caption-"+t).html('<i class="fa fa-clock-o fa-fw"></i> Please wait...')},a},success:function(a){$("#caption-"+t).html(a)}}):alert("File is to big")}function fileTypeID(t){switch(t){case"Rule":return 1;case"Form":return 2;default:return 3}}$(document).ready(function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),display(),$("#Rule").click(function(){addFile($(this),$("#ruleTree"))}),$("#Form").click(function(){addFile($(this),$("#formTree"))}),$("#ruleTree").sortable({placeholder:"ui-state-highlight",update:function(t,a){var i=a.item.attr("id").replace("item-",""),e=a.item.index();reorder(i,e)}}),$("#formTree").sortable({placeholder:"ui-state-highlight",update:function(t,a){var i=a.item.attr("id").replace("item-",""),e=a.item.index();reorder(i,e)}})});